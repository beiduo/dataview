<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>data demo</title>
    <script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="script/jquery.dataview.js"></script>
</head>
<body>
<div id="container"></div>
</body>
<script type="text/javascript">
//<![CDATA[

$.ajax({
    url: 'data/data.json',
    dataType: 'json',
    cache: false,
    success: function(data){
        var dataTable = $('#container').dataView(data, {
            items: {
                delete: function(){
                    this.node.parentNode.removeChild(this.node);
                },
                event: function(){
                    var self = this;

                    $(self.node).delegate('a', 'click', function(){
                        if ($(this).is('.delete')){
                            self.delete();
                            return false;
                        } else if ($(this).is('.edit')){
                            self.render(1);
                            return false;
                        } else if ($(this).is('.cancel')){
                            self.render(0);
                            return false;
                        } else if ($(this).is('.save')){
                            $.ajax({
                                url: 'data/edit.json',
                                dataType: 'json',
                                cache: false,
                                success: function(data){
                                    if (data.status === 'success'){
                                        self.render(2, data.data);
                                    }
                                }
                            });
                            return false;
                        }
                    });
                }
            },
            list: {
                event: function(){
                    var self = this;

                    var tracking = function(){
                        dataTable.track({
                            url: 'data/track.json',
                            callback: function(data){
                                return data;
                            }
                        });
                        setTimeout(tracking, 5000);
                    }

                    setTimeout(tracking, 5000);
                }
            },
            buttons: [
                {
                    text: 'delete',
                    process: function(){
                        dataTable.batch(function(items){
                            if (confirm('are you sure you want to delete all the items that have been choosen?')){
                                for (var key in items){
                                    if (typeof items[key].delete === 'function'){
                                        items[key].delete();
                                    }
                                }
                            } else {
                                return false;
                            }
                        });
                    }
                },
                {
                    text: 'delete2',
                    process: function(){
                        dataTable.batch({
                            before: function(items){
                                 if (confirm('are you sure you want to delete all the items that have been choosen?')){
                                    for (var key in items){
                                        items[key].render(2, {
                                            status: 'loading',
                                            statustext: 'deleting'
                                        });
                                    }
                                } else {
                                    return false;
                                }
                            },
                            url: 'data/batch.json',
                            after: function(items){
                                alert(item.length);
                                return items;
                            }
                        });
                    }
                }
            ]
        });

        try { console.log(dataTable); } catch (e){}
    }
})


//]]>
</script>
</html>
