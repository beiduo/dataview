<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>data demo</title>
    <script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="script/jquery.dataview.js"></script>
</head>
<body>
<div id="container"></div>
</body>
<script type="text/javascript">
//<![CDATA[

$.ajax({
    url: 'data/data.json',
    dataType: 'json',
    cache: false,
    success: function(data){
        var dataTable = $('#container').dataView(data, {
            items: {
                delete: function(){
                    var self = this;
                    self.node.parentNode.removeChild(self.node);
                    return false;
                },
                event: function(){
                    var self = this;

                    $(self.node).delegate('a', 'click', function(){
                        if ($(this).is('.delete')){
                            self.delete();
                        } else if ($(this).is('.edit')){
                            console.log(dataTable);
                            self.render(1);
                        } else if ($(this).is('.cancel')){
                            self.render(0);
                        } else if ($(this).is('.save')){
                            $.ajax({
                                url: 'data/edit.json',
                                dataType: 'json',
                                cache: false,
                                success: function(data){
                                    if (data.status === 'success'){
                                        self.render(0, data.data);
                                    }
                                }
                            });
                        }
                    });
                }
            },
            list: {
                event: function(){
                    var self = this;

                    var tracking = function(){
                        self.track('data/track.json');
                        setTimeout(tracking, 5000);
                    }

                    setTimeout(tracking, 5000);
                }
            }
        });

        try { console.log(dataTable); } catch (e){}
    }
})


//]]>
</script>
</html>
